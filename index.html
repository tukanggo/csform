<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Requirement Form</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
<div class="container">
  <h2>Customer Requirement Form</h2>
  <input type="text" name="name" placeholder="Name">
  <input type="text" name="address" placeholder="Address">
  <input type="text" name="contact" placeholder="Contact">
  <textarea name="requirement" placeholder="Requirement"></textarea>
  <input type="text" id="preferred_date" placeholder="dd/mm/yyyy">
  <input type="time" name="preferred_time">
  <input type="file" name="photos" multiple>
  <button id="submitBtn">Submit</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://unpkg.com/aws-amplify@latest/dist/aws-amplify.min.js"></script>

<script>
flatpickr("#preferred_date", { dateFormat: "d/m/Y" });

aws_amplify.Amplify.configure({
    Auth: {
        identityPoolId: "YOUR_IDENTITY_POOL_ID",
        region: "ap-southeast-1"
    },
    Storage: {
        AWSS3: {
            bucket: "customer-form-uploads",
            region: "ap-southeast-1"
        }
    },
    API: {
        endpoints: [
            {
                name: "CustomerAPI",
                endpoint: "YOUR_API_GATEWAY_URL",
                region: "ap-southeast-1"
            }
        ]
    }
});

async function uploadPhotos(files){
    const urls = [];
    for(const file of files){
        const key = `uploads/${Date.now()}-${file.name}`;
        await aws_amplify.Storage.put(key, file, {contentType:file.type});
        urls.push(`https://customer-form-uploads.s3.ap-southeast-1.amazonaws.com/${key}`);
    }
    return urls;
}

document.getElementById("submitBtn").addEventListener("click", async ()=>{
    const formData = {
        name: document.querySelector('input[name="name"]').value,
        address: document.querySelector('input[name="address"]').value,
        contact: document.querySelector('input[name="contact"]').value,
        requirement: document.querySelector('textarea[name="requirement"]').value,
        preferred_date: document.querySelector('#preferred_date').value,
        preferred_time: document.querySelector('input[name="preferred_time"]').value
    };
    const files = document.querySelector('input[name="photos"]').files;
    const photoUrls = await uploadPhotos(files);

    await aws_amplify.API.post("CustomerAPI", "/submit", { body: {...formData, photos: photoUrls} });
    alert("Form submitted successfully!");
});
</script>
</body>
</html>
